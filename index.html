<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    
    <!-- PWA Theme Colors -->
    <meta name="theme-color" content="#667eea" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1a2e" media="(prefers-color-scheme: dark)">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VPet">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png">
    
    <!-- Android PWA Support -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="VPet">
    
    <!-- Disable tap highlight on Android -->
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="css/mobile-enhancements.css" as="style">
    <link rel="preload" href="css/theme-improvements.css" as="style">
    <link rel="preload" href="css/gateway-interactions.css" as="style">
    <link rel="preload" href="css/fab-styles.css" as="style">
    
    <title>Virtual Pet - VPet</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile-enhancements.css">
    <link rel="stylesheet" href="css/theme-improvements.css">
    <link rel="stylesheet" href="css/gateway-interactions.css">
    <link rel="stylesheet" href="css/fab-styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¾ Virtual Pet</h1>
            <div class="server-status" id="serverStatus" title="Click to retry connection">
                <span class="status-dot offline"></span>
                <span class="status-text">Offline</span>
                <span class="status-retry" style="display: none;">ğŸ”„</span>
            </div>
        </header>

        <main>
            <!-- Pet Display Area -->
            <div class="pet-display">
                <div class="mood-indicator" id="moodIndicator">ğŸ˜Š</div>
                <div class="pet-sprite" id="petSprite">
                    <div class="pet-animation">
                        <div class="pet-mouth"></div>
                    </div>
                </div>
                <div class="pet-name" id="petName">My Pet</div>
                <div class="pet-stage" id="petStage">Egg</div>
                <div class="evolution-preview" id="evolutionPreview" style="display: none;">
                    <div class="evolution-progress-text">Next Evolution</div>
                    <div class="evolution-progress-bar">
                        <div class="evolution-progress-fill" id="evolutionProgressFill"></div>
                    </div>
                    <div class="evolution-time" id="evolutionTime"></div>
                </div>
            </div>

            <!-- Stats Display -->
            <div class="stats-panel circular-mode" id="statsPanel">
                <div class="stat-bar" data-tooltip="" role="group" aria-labelledby="health-label">
                    <div class="stat-label" id="health-label">
                        <span>â¤ï¸ Health</span>
                        <span id="healthValue">100</span>
                    </div>
                    <div class="progress-bar" id="healthBarContainer" role="progressbar" 
                         aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" 
                         aria-label="Health: 100 out of 100">
                        <div class="progress-fill health" id="healthBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80" aria-hidden="true">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill health" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="healthCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="healthCircleValue">100</div>
                    </div>
                </div>

                <div class="stat-bar" data-tooltip="">
                    <div class="stat-label">
                        <span>ğŸ” Hunger</span>
                        <span id="hungerValue">100</span>
                    </div>
                    <div class="progress-bar" id="hungerBarContainer">
                        <div class="progress-fill hunger" id="hungerBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill hunger" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="hungerCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="hungerCircleValue">100</div>
                    </div>
                </div>

                <div class="stat-bar" data-tooltip="">
                    <div class="stat-label">
                        <span>ğŸ˜Š Happiness</span>
                        <span id="happinessValue">100</span>
                    </div>
                    <div class="progress-bar" id="happinessBarContainer">
                        <div class="progress-fill happiness" id="happinessBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill happiness" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="happinessCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="happinessCircleValue">100</div>
                    </div>
                </div>

                <div class="stat-bar" data-tooltip="">
                    <div class="stat-label">
                        <span>âš¡ Energy</span>
                        <span id="energyValue">100</span>
                    </div>
                    <div class="progress-bar" id="energyBarContainer">
                        <div class="progress-fill energy" id="energyBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill energy" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="energyCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="energyCircleValue">100</div>
                    </div>
                </div>

                <div class="stat-bar" data-tooltip="">
                    <div class="stat-label">
                        <span>ğŸ§¹ Cleanliness</span>
                        <span id="cleanlinessValue">100</span>
                    </div>
                    <div class="progress-bar" id="cleanlinessBarContainer">
                        <div class="progress-fill cleanliness" id="cleanlinessBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill cleanliness" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="cleanlinessCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="cleanlinessCircleValue">100</div>
                    </div>
                </div>

                <!-- Egg-only stat -->
                <div class="stat-bar egg-only" id="warmthStat" style="display: none;" data-tooltip="">
                    <div class="stat-label">
                        <span>ğŸ”¥ Warmth</span>
                        <span id="warmthValue">50</span>
                    </div>
                    <div class="progress-bar" id="warmthBarContainer">
                        <div class="progress-fill warmth" id="warmthBar"></div>
                    </div>
                    <div class="circular-gauge">
                        <svg viewBox="0 0 80 80">
                            <circle class="circular-gauge-bg" cx="40" cy="40" r="32"></circle>
                            <circle class="circular-gauge-fill warmth" cx="40" cy="40" r="32" 
                                    stroke-dasharray="201" stroke-dashoffset="0" id="warmthCircle"></circle>
                        </svg>
                        <div class="circular-gauge-value" id="warmthCircleValue">50</div>
                    </div>
                    <div class="warmth-status" id="warmthStatus"></div>
                </div>

                <div class="stat-info">
                    <div>Age: <span id="petAge">0</span></div>
                    <div>Level: <span id="petLevel">1</span></div>
                    <div>Wins: <span id="petWins">0</span></div>
                    <div>Coins: <span id="petCoins">0</span> ğŸ’°</div>
                </div>
            </div>

            <!-- Egg Action Buttons (shown only for eggs) -->
            <div class="action-panel egg-only" id="eggActionPanel" style="display: none;">
                <button class="action-btn warm-btn" id="warmBtn">
                    <span class="btn-icon">ğŸ”¥</span>
                    <span>Warm Egg</span>
                </button>
                <button class="action-btn hatch-btn" id="hatchBtn" disabled>
                    <span class="btn-icon">ğŸ£</span>
                    <span>Hatch</span>
                </button>
            </div>

            <!-- Action Buttons (hidden for eggs) -->
            <div class="action-panel non-egg" id="normalActionPanel">
                <button class="action-btn feed-btn" id="feedBtn" 
                        aria-label="Feed your pet to restore hunger" 
                        title="Feed your pet">
                    <span class="btn-icon" aria-hidden="true">ğŸ–</span>
                    <span>Feed</span>
                </button>
                <button class="action-btn play-btn" id="playBtn" 
                        aria-label="Play with your pet to increase happiness" 
                        title="Play with your pet">
                    <span class="btn-icon" aria-hidden="true">ğŸ®</span>
                    <span>Play</span>
                </button>
                <button class="action-btn sleep-btn" id="sleepBtn" 
                        aria-label="Put your pet to sleep to restore energy" 
                        title="Put pet to sleep">
                    <span class="btn-icon" aria-hidden="true">ğŸ’¤</span>
                    <span>Sleep</span>
                </button>
                <button class="action-btn train-btn" id="trainBtn" 
                        aria-label="Train your pet to increase level" 
                        title="Train your pet">
                    <span class="btn-icon" aria-hidden="true">ğŸ’ª</span>
                    <span>Train</span>
                </button>
                <button class="action-btn clean-btn" id="cleanBtn" 
                        aria-label="Clean your pet to maintain hygiene" 
                        title="Clean your pet">
                    <span class="btn-icon" aria-hidden="true">ğŸ§¹</span>
                    <span>Clean</span>
                </button>
            </div>

            <!-- Battle Section -->
            <div class="battle-panel">
                <button class="battle-btn" id="battleBtn">
                    <span class="btn-icon">âš”ï¸</span>
                    <span>Battle</span>
                </button>
                <button class="online-battle-btn" id="onlineBattleBtn" disabled>
                    <span class="btn-icon">ğŸŒ</span>
                    <span>Online Battle</span>
                </button>
            </div>

            <!-- Social Features Section -->
            <div class="social-panel">
                <button class="social-btn" id="shareBtn" title="Share your pet">
                    <span class="btn-icon">ğŸ“¤</span>
                    <span>Share</span>
                </button>
                <button class="social-btn" id="leaderboardBtn" title="View leaderboard">
                    <span class="btn-icon">ğŸ†</span>
                    <span>Leaderboard</span>
                </button>
                <button class="social-btn" id="friendsBtn" title="Manage friends">
                    <span class="btn-icon">ğŸ‘¥</span>
                    <span>Friends</span>
                </button>
                <button class="social-btn" id="tournamentBtn" title="Tournaments">
                    <span class="btn-icon">ğŸ…</span>
                    <span>Tournament</span>
                </button>
            </div>

            <!-- Shop/Inventory/Games removed - accessed via Feed/Play gateway modals -->
            <!-- Backup/Cryo moved to settings to reduce clutter -->

            <!-- Settings FAB (Floating Action Button) -->
            <button class="settings-fab" id="settingsBtn" title="Settings" aria-label="Open Settings">
                âš™ï¸
            </button>
        </main>

        <!-- Modals Section -->
        <!-- Modal for Battle -->
        <div class="modal" id="battleModal">
            <div class="modal-content">
                <span class="close-btn" id="closeBattleModal">&times;</span>
                <h2>Battle Arena</h2>
                <div class="battle-arena">
                    <div class="battle-pet your-pet">
                        <div class="battle-sprite"></div>
                        <div class="battle-pet-name" id="battleYourName">Your Pet</div>
                        <div class="battle-hp-bar">
                            <div class="battle-hp-fill" id="battleYourHp"></div>
                        </div>
                        <div class="battle-stats">
                            <div class="battle-stat">âš”ï¸ <span id="battleYourAttack">0</span></div>
                            <div class="battle-stat">ğŸ›¡ï¸ <span id="battleYourDefense">0</span></div>
                        </div>
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="battle-pet opponent-pet">
                        <div class="battle-sprite"></div>
                        <div class="battle-pet-name" id="battleOpponentName">Opponent</div>
                        <div class="battle-hp-bar">
                            <div class="battle-hp-fill" id="battleOpponentHp"></div>
                        </div>
                        <div class="battle-stats">
                            <div class="battle-stat">âš”ï¸ <span id="battleOpponentAttack">0</span></div>
                            <div class="battle-stat">ğŸ›¡ï¸ <span id="battleOpponentDefense">0</span></div>
                        </div>
                    </div>
                </div>
                <div class="battle-log" id="battleLog"></div>
                <div class="battle-actions" id="battleActions">
                    <button class="battle-action-btn" id="attackBtn">Attack</button>
                    <button class="battle-action-btn" id="defendBtn">Defend</button>
                    <button class="battle-action-btn" id="specialBtn">Special</button>
                </div>
                <button class="battle-action-btn finish-btn" id="finishBattleBtn" style="display: none;">Finish</button>
            </div>
        </div>

        <!-- Modal for Settings -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <span class="close-btn" id="closeSettingsModal">&times;</span>
                <h2>Settings</h2>
                <div class="settings-content">
                    <div class="setting-item">
                        <label for="petNameInput">Pet Name:</label>
                        <input type="text" id="petNameInput" maxlength="15" />
                    </div>
                    <div class="setting-item">
                        <label for="serverUrlInput">Server URL:</label>
                        <input type="text" id="serverUrlInput" placeholder="ws://localhost:3000" />
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="soundToggle" checked />
                            ğŸ”Š Sound Effects
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="vibrationToggle" checked />
                            ğŸ“³ Vibration Feedback
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label for="themeSelect">ğŸ¨ Theme:</label>
                        <select id="themeSelect">
                            <option value="dark">Dark Mode</option>
                            <option value="light">Light Mode</option>
                            <option value="retro">Retro LCD</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label for="statDisplaySelect">ğŸ“Š Stat Display:</label>
                        <select id="statDisplaySelect">
                            <option value="bars">Horizontal Bars</option>
                            <option value="circular">Circular Gauges</option>
                        </select>
                    </div>
                    
                    <!-- Premium Section -->
                    <div class="setting-item premium-section">
                        <button class="premium-cta-btn" id="premiumCtaBtn">â­ Upgrade to Premium</button>
                    </div>
                    
                    <!-- Battle History Section -->
                    <div class="battle-history-section">
                        <h3>âš”ï¸ Battle History</h3>
                        <div id="battleHistoryList" class="battle-history-list">
                            <p class="no-history">No battles yet</p>
                        </div>
                    </div>
                    
                    <!-- Quick Actions Section -->
                    <div class="settings-quick-actions">
                        <button class="quick-action-btn" id="settingsHibernateBtn">
                            <span class="btn-icon">â„ï¸</span>
                            <span>Cryo Sleep</span>
                        </button>
                        <button class="quick-action-btn" id="settingsBackupBtn">
                            <span class="btn-icon">ğŸ’¾</span>
                            <span>Backup Data</span>
                        </button>
                        <button class="quick-action-btn" id="settingsHelpBtn">
                            <span class="btn-icon">â“</span>
                            <span>Help & Guide</span>
                        </button>
                    </div>
                    
                    <button class="save-settings-btn" id="saveSettingsBtn">Save</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div class="notification" id="notification"></div>
        
        <!-- Auto-save Indicator -->
        <div class="save-indicator" id="saveIndicator">Saved âœ“</div>
        
        <!-- Time Away Modal -->
        <div class="modal" id="timeAwayModal">
            <div class="modal-content">
                <h2>Welcome Back!</h2>
                <div class="time-away-content" id="timeAwayContent"></div>
                <button class="battle-action-btn finish-btn" id="closeTimeAwayBtn">Continue</button>
            </div>
        </div>
    </div>

    <!-- Help/Tutorial Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-overlay">
            <div class="modal-content help-modal-content">
                <span class="close-btn" id="closeHelpModal">Ã—</span>
                <h2>How to Play VPet ğŸ¾</h2>
                
                <div class="help-section">
                    <h3>ğŸ“š Pet Care</h3>
                    <ul>
                        <li><strong>ğŸ– Feed (F)</strong> - Restore hunger and health</li>
                        <li><strong>ğŸ® Play (P)</strong> - Increase happiness (uses energy)</li>
                        <li><strong>ğŸ’¤ Sleep (S)</strong> - Restore energy over time</li>
                        <li><strong>ğŸ’ª Train (T)</strong> - Increase level (requires energy)</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ“Š Stats Guide</h3>
                    <ul>
                        <li><strong>â¤ï¸ Health</strong> - Keep hunger high to maintain health</li>
                        <li><strong>ğŸ” Hunger</strong> - Decreases over time (~1.5/min)</li>
                        <li><strong>ğŸ˜Š Happiness</strong> - Decreases over time (~1.0/min)</li>
                        <li><strong>âš¡ Energy</strong> - Decreases over time (~0.8/min), restored by sleep</li>
                        <li><strong>ğŸ§¹ Cleanliness</strong> - Decreases over time (~1.2/min)</li>
                    </ul>
                    <p><strong>Tip:</strong> Stat bars glow red when critical (&lt;30%), yellow when low (&lt;50%), and green when excellent (â‰¥90%)</p>
                    <p><strong>Time:</strong> All time is in real-world time. Your pet ages in real-time even when you're away!</p>
                </div>
                
                <div class="help-section">
                    <h3>ğŸŒ± Evolution</h3>
                    <p>Your pet evolves through 5 stages based on age (real-time):</p>
                    <ul>
                        <li>ğŸ¥š Egg (0-15min) â†’ ğŸ‘¶ Baby (15min-1.0hr) â†’ ğŸ§’ Child (1.0-2.4hr) â†’ ğŸ§‘ Teen (2.4-5.0hr) â†’ ğŸ‘¨ Adult (5hr+)</li>
                    </ul>
                    <p>Check the evolution preview to see exact time until next stage!</p>
                </div>
                
                <div class="help-section">
                    <h3>âš”ï¸ Battles (B)</h3>
                    <ul>
                        <li><strong>Attack</strong> - Deal damage to opponent</li>
                        <li><strong>Defend</strong> - Reduce incoming damage</li>
                        <li><strong>Special</strong> - High risk, high reward move</li>
                    </ul>
                    <p>Battles require 30 energy. Win to gain experience and levels!</p>
                </div>
                
                <div class="help-section">
                    <h3>âŒ¨ï¸ Keyboard Shortcuts</h3>
                    <ul>
                        <li><strong>F</strong> - Feed</li>
                        <li><strong>P</strong> - Play</li>
                        <li><strong>S</strong> - Sleep</li>
                        <li><strong>T</strong> - Train</li>
                        <li><strong>B</strong> - Battle</li>
                        <li><strong>ESC</strong> - Close modals</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>ğŸ’¡ Pro Tips</h3>
                    <ul>
                        <li>Hover over stat bars for detailed information</li>
                        <li>Watch the mood indicator (ğŸ˜Š) above your pet</li>
                        <li>Data is auto-saved after every action</li>
                        <li>Your pet continues to age even when you're away!</li>
                    </ul>
                </div>
                
                <button class="battle-action-btn finish-btn" id="closeHelpBtn">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" class="modal">
        <div id="premiumModalContent">
            <!-- Content will be dynamically populated by premium.js -->
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div class="modal" id="leaderboardModal">
        <div class="modal-content">
            <span class="close-btn" id="closeLeaderboardModal">Ã—</span>
            <h2>ğŸ† Leaderboard</h2>
            <div class="leaderboard-content" id="leaderboardContent">
                <div class="loading">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Hibernation Modal -->
    <div class="modal" id="hibernationModal">
        <div class="modal-content">
            <span class="close-btn" id="closeHibernationModal">Ã—</span>
            <h2>â„ï¸ Cryo Sleep</h2>
            <div class="hibernation-content">
                <p>Put your pet into suspended animation when you need a break!</p>
                <div class="hibernation-status" id="hibernationStatus">
                    <!-- Status will be populated dynamically -->
                </div>
                <div class="hibernation-controls" id="hibernationControls">
                    <!-- Controls will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div class="modal" id="backupModal">
        <div class="modal-content">
            <span class="close-btn" id="closeBackupModal">Ã—</span>
            <h2>ğŸ’¾ Backup & Restore</h2>
            <div class="backup-content">
                <p>Save and restore your pet's progress!</p>
                <div class="backup-section">
                    <h3>Local Backup (All Users)</h3>
                    <button class="action-btn" id="exportBackupBtn">
                        <span class="btn-icon">ğŸ’¾</span>
                        <span>Export Backup</span>
                    </button>
                    <div class="file-input-wrapper">
                        <button class="action-btn" id="importBackupBtnTrigger">
                            <span class="btn-icon">ğŸ“¥</span>
                            <span>Import Backup</span>
                        </button>
                        <input type="file" id="importBackupInput" accept=".json" style="display: none;" />
                    </div>
                    <div class="backup-info" id="localBackupInfo">
                        Last backup: <span id="lastBackupTime">Never</span>
                    </div>
                </div>
                <div class="backup-section cloud-backup">
                    <h3>â˜ï¸ Cloud Backup (Premium Only)</h3>
                    <button class="action-btn" id="saveToCloudBtn">
                        <span class="btn-icon">â˜ï¸</span>
                        <span>Save to Cloud</span>
                    </button>
                    <button class="action-btn" id="loadFromCloudBtn">
                        <span class="btn-icon">ğŸ“¥</span>
                        <span>Load from Cloud</span>
                    </button>
                    <div class="backup-toggle">
                        <label>
                            <input type="checkbox" id="autoCloudBackupToggle" />
                            Automatic cloud backups
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <span class="close-btn" id="closeShopModal">Ã—</span>
            <h2>ğŸª Shop</h2>
            <div class="shop-content">
                <div class="coin-display">Coins: <span id="coinBalance">0</span> ğŸ’°</div>
                <div class="shop-categories">
                    <button class="category-btn active" data-category="all">All</button>
                    <button class="category-btn" data-category="food">Food</button>
                    <button class="category-btn" data-category="medicine">Medicine</button>
                    <button class="category-btn" data-category="battle">Battle</button>
                    <button class="category-btn" data-category="evolution">Evolution</button>
                    <button class="category-btn" data-category="cosmetic">Cosmetic</button>
                </div>
                <div class="shop-items" id="shopItems">
                    <!-- Items will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="modal" id="inventoryModal">
        <div class="modal-content">
            <span class="close-btn" id="closeInventoryModal">Ã—</span>
            <h2>ğŸ’ Inventory</h2>
            <div class="inventory-content">
                <div class="inventory-items" id="inventoryItems">
                    <!-- Items will be populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mini-Games Modal -->
    <div class="modal" id="minigamesModal">
        <div class="modal-content">
            <span class="close-btn" id="closeMinigamesModal">Ã—</span>
            <h2>ğŸ¯ Mini-Games</h2>
            <div class="minigames-menu" id="minigamesMenu">
                <div class="game-card">
                    <h3>ğŸ¯ Reaction Game</h3>
                    <p>Catch falling items before they hit the ground!</p>
                    <p class="high-score">Best: <span id="reactionHighScore">0</span></p>
                    <button class="action-btn" id="playReactionBtn">Play</button>
                </div>
                <div class="game-card">
                    <h3>ğŸ§© Memory Game</h3>
                    <p>Match pairs of cards!</p>
                    <p class="high-score">Best: <span id="memoryHighScore">0</span></p>
                    <button class="action-btn" id="playMemoryBtn">Play</button>
                </div>
                <div class="game-card">
                    <h3>ğŸµ Rhythm Game</h3>
                    <p>Hit notes at the right time! (D, F, J, K keys)</p>
                    <p class="high-score">Best: <span id="rhythmHighScore">0</span></p>
                    <button class="action-btn" id="playRhythmBtn">Play</button>
                </div>
            </div>
            <div class="game-canvas-container" id="gameCanvasContainer" style="display: none;">
                <canvas id="gameCanvas" width="350" height="500"></canvas>
                <button class="action-btn" id="endGameBtn">End Game</button>
            </div>
        </div>
    </div>

    <!-- Friends Modal -->
    <div class="modal" id="friendsModal">
        <div class="modal-content">
            <span class="close-btn" id="closeFriendsModal">Ã—</span>
            <h2>ğŸ‘¥ Friends</h2>
            <div class="friends-content">
                <div class="friend-tabs">
                    <button class="tab-btn active" data-tab="list">Friends</button>
                    <button class="tab-btn" data-tab="requests">Requests</button>
                    <button class="tab-btn" data-tab="add">Add Friend</button>
                </div>
                <div class="tab-content" id="friendsListTab">
                    <div id="friendsList">
                        <!-- Friends will be populated dynamically -->
                    </div>
                </div>
                <div class="tab-content" style="display: none;" id="friendRequestsTab">
                    <div id="friendRequests">
                        <!-- Requests will be populated dynamically -->
                    </div>
                </div>
                <div class="tab-content" style="display: none;" id="addFriendTab">
                    <input type="text" id="friendUsernameInput" placeholder="Enter username" />
                    <button class="action-btn" id="sendFriendRequestBtn">Send Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tournament Modal -->
    <div class="modal" id="tournamentModal">
        <div class="modal-content">
            <span class="close-btn" id="closeTournamentModal">Ã—</span>
            <h2>ğŸ… Tournament</h2>
            <div class="tournament-content" id="tournamentContent">
                <!-- Tournament UI will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Kitchen/Feed Modal (Gateway for Feed Button) -->
    <div class="modal" id="kitchenModal">
        <div class="modal-content gateway-modal">
            <span class="close-btn" id="closeKitchenModal">Ã—</span>
            <h2>ğŸ– Kitchen & Inventory</h2>
            <div class="kitchen-content">
                <div class="quick-action-bar">
                    <button class="quick-action-btn" id="quickFeedBtn">
                        <span class="btn-icon">âš¡</span>
                        <span>Quick Feed</span>
                    </button>
                    <div class="hunger-display">
                        Hunger: <span id="kitchenHungerValue">100</span>%
                    </div>
                </div>
                <div class="food-grid" id="foodGrid">
                    <!-- Food items will be populated dynamically from inventory -->
                </div>
                <div class="kitchen-actions">
                    <button class="action-btn" id="openShopFromKitchen">
                        <span class="btn-icon">ğŸª</span>
                        <span>Buy Food</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Activities Hub Modal (Gateway for Play Button) -->
    <div class="modal" id="activitiesModal">
        <div class="modal-content gateway-modal">
            <span class="close-btn" id="closeActivitiesModal">Ã—</span>
            <h2>ğŸ® Activities Hub</h2>
            <div class="activities-content">
                <div class="quick-action-bar">
                    <button class="quick-action-btn" id="quickPlayBtn">
                        <span class="btn-icon">âš¡</span>
                        <span>Quick Play</span>
                    </button>
                    <div class="happiness-display">
                        Happiness: <span id="activitiesHappinessValue">100</span>%
                    </div>
                </div>
                <div class="activities-grid">
                    <div class="activity-card" id="playMinigamesBtn" role="button" tabindex="0">
                        <span class="activity-icon">ğŸ¯</span>
                        <h3>Mini-Games</h3>
                        <p>Reaction, Memory, Rhythm</p>
                        <div class="activity-bonus">+Happiness +Coins</div>
                    </div>
                    <div class="activity-card" id="playExploreBtn" role="button" tabindex="0">
                        <span class="activity-icon">ğŸ—ºï¸</span>
                        <h3>Explore</h3>
                        <p>Adventure & Discovery</p>
                        <div class="activity-bonus">+XP +Items</div>
                    </div>
                    <div class="activity-card" id="playSocialBtn" role="button" tabindex="0">
                        <span class="activity-icon">ğŸ‘¥</span>
                        <h3>Social Play</h3>
                        <p>Visit friends' pets</p>
                        <div class="activity-bonus">+Happiness +Social</div>
                    </div>
                    <div class="activity-card" id="playToysBtn" role="button" tabindex="0">
                        <span class="activity-icon">ğŸ¾</span>
                        <h3>Toys</h3>
                        <p>Use inventory items</p>
                        <div class="activity-bonus">+Happiness +Fun</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rest Menu Modal (Gateway for Sleep Button) -->
    <div class="modal" id="restModal">
        <div class="modal-content gateway-modal">
            <span class="close-btn" id="closeRestModal">Ã—</span>
            <h2>ğŸ˜´ Rest & Relaxation</h2>
            <div class="rest-content">
                <div class="quick-action-bar">
                    <button class="quick-action-btn" id="quickSleepBtn">
                        <span class="btn-icon">âš¡</span>
                        <span>Quick Nap</span>
                    </button>
                    <div class="energy-display">
                        Energy: <span id="restEnergyValue">100</span>%
                    </div>
                </div>
                <div class="rest-options">
                    <div class="rest-option-card" id="normalSleepBtn" role="button" tabindex="0">
                        <span class="rest-icon">ğŸ’¤</span>
                        <h3>Normal Sleep</h3>
                        <p>Standard rest period</p>
                        <div class="rest-benefit">+50 Energy (2-4 hours)</div>
                    </div>
                    <div class="rest-option-card" id="deepSleepBtn" role="button" tabindex="0">
                        <span class="rest-icon">ğŸŒ™</span>
                        <h3>Deep Sleep</h3>
                        <p>Extended rest for full recovery</p>
                        <div class="rest-benefit">+100 Energy (6-8 hours)</div>
                    </div>
                    <div class="rest-option-card" id="cryoSleepBtn" role="button" tabindex="0">
                        <span class="rest-icon">â„ï¸</span>
                        <h3>Cryo Sleep</h3>
                        <p>Pause when you need a break</p>
                        <div class="rest-benefit">Suspend all stats</div>
                    </div>
                    <div class="rest-option-card" id="dreamActivityBtn" role="button" tabindex="0">
                        <span class="rest-icon">âœ¨</span>
                        <h3>Dream Activity</h3>
                        <p>Light rest + dream games</p>
                        <div class="rest-benefit">+30 Energy +Fun</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grooming Center Modal (Gateway for Clean Button) -->
    <div class="modal" id="groomingModal">
        <div class="modal-content gateway-modal">
            <span class="close-btn" id="closeGroomingModal">Ã—</span>
            <h2>ğŸ§¼ Grooming Center</h2>
            <div class="grooming-content">
                <div class="quick-action-bar">
                    <button class="quick-action-btn" id="quickCleanBtn">
                        <span class="btn-icon">âš¡</span>
                        <span>Quick Clean</span>
                    </button>
                    <div class="cleanliness-display">
                        Cleanliness: <span id="groomingCleanValue">100</span>%
                    </div>
                </div>
                <div class="grooming-options">
                    <div class="grooming-card" id="bathGameBtn" role="button" tabindex="0">
                        <span class="grooming-icon">ğŸ›</span>
                        <h3>Bath Time</h3>
                        <p>Interactive washing mini-game</p>
                        <div class="grooming-bonus">+Clean +Happiness +Coins</div>
                    </div>
                    <div class="grooming-card" id="brushGameBtn" role="button" tabindex="0">
                        <span class="grooming-icon">âœ¨</span>
                        <h3>Brush & Polish</h3>
                        <p>Grooming care activity</p>
                        <div class="grooming-bonus">+Clean +Appearance</div>
                    </div>
                    <div class="grooming-card" id="spaBtn" role="button" tabindex="0">
                        <span class="grooming-icon">ğŸŒ¸</span>
                        <h3>Spa Treatment</h3>
                        <p>Premium grooming (costs coins)</p>
                        <div class="grooming-bonus">++Clean ++Happiness</div>
                    </div>
                    <div class="grooming-card" id="cosmeticsBtn" role="button" tabindex="0">
                        <span class="grooming-icon">ğŸ’„</span>
                        <h3>Cosmetics</h3>
                        <p>Unlock & apply styles</p>
                        <div class="grooming-bonus">Customization</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Center Modal (Gateway for Train Button) -->
    <div class="modal" id="trainingModal">
        <div class="modal-content gateway-modal">
            <span class="close-btn" id="closeTrainingModal">Ã—</span>
            <h2>ğŸ’ª Training Center</h2>
            <div class="training-content">
                <div class="quick-action-bar">
                    <button class="quick-action-btn" id="quickTrainBtn">
                        <span class="btn-icon">âš¡</span>
                        <span>Quick Train</span>
                    </button>
                    <div class="training-stats">
                        Lvl: <span id="trainingLevelValue">1</span> | 
                        XP: <span id="trainingXPValue">0</span>/100
                    </div>
                </div>
                <div class="stats-overview">
                    <div class="stat-display">
                        âš”ï¸ Attack: <span id="trainingAttackValue">10</span>
                    </div>
                    <div class="stat-display">
                        ğŸ›¡ï¸ Defense: <span id="trainingDefenseValue">10</span>
                    </div>
                    <div class="stat-display">
                        âš¡ Speed: <span id="trainingSpeedValue">10</span>
                    </div>
                </div>
                <div class="training-options">
                    <div class="training-card" id="strengthTrainBtn" role="button" tabindex="0">
                        <span class="training-icon">âš”ï¸</span>
                        <h3>Strength Training</h3>
                        <p>Increase attack power</p>
                        <div class="training-cost">-20 Energy</div>
                    </div>
                    <div class="training-card" id="defenseTrainBtn" role="button" tabindex="0">
                        <span class="training-icon">ğŸ›¡ï¸</span>
                        <h3>Defense Training</h3>
                        <p>Boost defensive stats</p>
                        <div class="training-cost">-20 Energy</div>
                    </div>
                    <div class="training-card" id="speedTrainBtn" role="button" tabindex="0">
                        <span class="training-icon">âš¡</span>
                        <h3>Speed Training</h3>
                        <p>Enhance agility</p>
                        <div class="training-cost">-20 Energy</div>
                    </div>
                    <div class="training-card" id="balancedTrainBtn" role="button" tabindex="0">
                        <span class="training-icon">ğŸ¯</span>
                        <h3>Balanced Training</h3>
                        <p>All-around improvement</p>
                        <div class="training-cost">-30 Energy</div>
                    </div>
                    <div class="training-card" id="battlePrepBtn" role="button" tabindex="0">
                        <span class="training-icon">âš”ï¸</span>
                        <h3>Battle Prep</h3>
                        <p>Ready for combat</p>
                        <div class="training-cost">Opens Battle Menu</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Modules -->
    <script src="js/constants.js"></script>
    <script src="js/app-config.js"></script>
    <script src="js/pet-config.js"></script>
    <script src="js/battle-config.js"></script>
    
    <!-- Utility Modules -->
    <script src="js/input-validator.js"></script>
    <script src="js/accessibility.js"></script>
    <script src="js/pwa-installer.js"></script>
    <script src="js/sound-manager.js"></script>
    <script src="js/vibration-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/battle-ui-manager.js"></script>
    <script src="js/milestone-manager.js"></script>
    <script src="js/social-features.js"></script>
    <script src="js/particle-effects.js"></script>
    
    <!-- Phase 3-4 Feature Modules -->
    <script src="js/item-system.js"></script>
    <script src="js/minigames.js"></script>
    <script src="js/evolution-paths.js"></script>
    <script src="js/friend-system.js"></script>
    <script src="js/tournament-manager.js"></script>
    <script src="js/gateway-manager.js"></script>
    
    <!-- Core Classes -->
    <script src="js/pet.js"></script>
    <script src="js/battle.js"></script>
    <script src="js/server.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/feature-gate.js"></script>
    <script src="js/backup-manager.js"></script>
    <script src="js/hibernation-manager.js"></script>
    
    <!-- Phase 3-4 Integration -->
    <script src="js/phase34-integration.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>
</body>
</html>
